<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Dashboard | DR.URCW AI</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="/static/styles.css" rel="stylesheet">

</head>

<body>

<div class="container mt-5">

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3>Welcome back, {{ user.name }} ðŸ‘‹</h3>
        <button onclick="toggleMode()" class="btn btn-sm btn-secondary">ðŸŒ™</button>
    </div>

    <!-- ================= ANALYTICS ================= -->

    <div class="row g-4">

        <div class="col-md-4">
            <div class="card text-center p-3">
                <h6>Total Sessions</h6>
                <h3>{{ total_sessions }}</h3>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card text-center p-3">
                <h6>Total Messages</h6>
                <h3>{{ total_messages }}</h3>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card text-center p-3">
                <h6>Unanswered Questions</h6>
                <h3>{{ unanswered_count }}</h3>
            </div>
        </div>

    </div>

    <hr class="my-4">

    <!-- ================= POPULAR INTENTS ================= -->

    <h5>ðŸ”¥ Popular Topics</h5>

    <div class="card p-3 mt-2">
        <ul class="list-group list-group-flush">
            {% for intent in popular_intents %}
            <li class="list-group-item d-flex justify-content-between">
                <span>{{ intent.name if intent.name else intent[0] }}</span>
                <span class="badge bg-primary">{{ intent.count if intent.count else intent[1] }}</span>
            </li>
            {% endfor %}
        </ul>
    </div>

    <hr class="my-4">

    <!-- ================= CHAT SESSIONS ================= -->

    <div class="d-flex justify-content-between align-items-center">
        <h5>Your Conversations</h5>
        <a href="/chatbot" class="btn btn-primary">+ New Chat</a>
    </div>

    <div class="card p-3 mt-3" style="max-height:400px; overflow-y:auto;">

        {% if sessions %}
            {% for s in sessions %}
                <div class="border rounded p-3 mb-2 d-flex justify-content-between align-items-center">

                    <div>
                        <a href="/chatbot?session_id={{ s.id }}" class="text-decoration-none">
                            <strong>{{ s.title }}</strong><br>
                            <small class="text-muted">
                                {{ s.created_at.strftime('%d %b %Y, %I:%M %p') }}
                            </small>
                        </a>
                    </div>

                    <div>
                        <a href="/delete_chat/{{ s.id }}"
                           onclick="return confirm('Delete this chat?')"
                           class="text-danger text-decoration-none">
                           ðŸ—‘
                        </a>
                    </div>

                </div>
            {% endfor %}
        {% else %}
            <p class="text-muted">No conversations yet.</p>
        {% endif %}

    </div>

    <hr class="my-4">

    <!-- ================= ACCOUNT ================= -->

    <div class="card p-3">
        <h6>Account Information</h6>
        <p><strong>Name:</strong> {{ user.name }}</p>
        <p><strong>Email:</strong> {{ user.email }}</p>
        <a href="/profile" class="btn btn-outline-primary w-100">Edit Profile</a>
        <a href="/logout" class="btn btn-outline-danger w-100 mt-2">Logout</a>
    </div>

</div>

<script>
function toggleMode(){
    document.body.classList.toggle("dark");
}
</script>

</body>
</html>
